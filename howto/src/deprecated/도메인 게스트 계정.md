# 도메인 게스트 계정

## 도입 배경

기본적으로 도메인 계정은 어느 하나의 PC에만 존재하는 것이 아니므로, 계정 하나를 가지고 어느 실습실 PC에서건 로그인할 수 있다. 다만 홈 디렉토리 동기화 문제를 막기 위해 동시에 하나의 PC에서만 로그인할 수 있다는 제약이 붙는다.

가끔 실습 조교로부터 도메인 계정이 없는 수강생을 위한 보조 계정을 만들어달라는 요청이 들어올 때가 있는데, 종종 수업용 계정은 수업 당 하나가 발급된다. 하나의 도메인 계정으로 여러 사람이 동시에 사용할 수 없으므로, 각 PC에 로컬 계정을 만들어야 하는데 이는 아무리 자동화를 잘 시킨다 하더라도 Domain Controller에 접속해서 엔트리 하나만 만들어주면 땡인 도메인 계정보다는 만들기에 부담이 가는게 사실이다.

아래와 같은 일이 가능하다면 좋지 않을까?

* 수업용 보조계정을 도메인에 하나 추가한다.
* 그 계정을 sherry의 /csehome/.guests 에 추가하면, 그 계정은 임시 홈 디렉토리로 로그인된다. 즉,
    * 그 계정으로 여러 PC에서 로그인할 수 있다.
    * 로그아웃 후 디렉토리 내 파일은 삭제될 수 있다. 또한 이 사실을 로그인시 사용자에게 미리 공지할 수 있다.

## 만드는 방법

1. 도메인 컨트롤러 (콜라다나 피나) 에 접속한다.
1. 적절한 OU에 적절한 옵션으로 도메인 계정을 하나 판다.
    * 많은 경우 "사용자가 패스워드를 변경할 수 없음" 에 체크해야 할 것이다.
1. sherry.snucse.org에 접속해서 `/csehome/.guests`를 편집, 계정의 이름을 추가한다.
1. 만들어진 도메인 계정으로 마티니 등의 **실습 서버**에도 접속할 수 있다는 문제점이 있다. 이를 해결하기 위해 각 실습 서버에서
    1. `/etc/ssh/sshd_config` 를 열어서
    1. `DenyUsers` 옵션에 계정명을 추가해야 한다. (예시: `DenyUsers cseclass icpc`)
    1. 이상의 일은 다음 서버에서 수행해야 한다: `martini.snucse.org` `ipa.snucse.org`

## TODO

마티니, IPA 등에도 sherry의 `/csehome` 에 접근할 수 있는 NFS를 설정하고, `pam_listfile.so` 모듈을 이용하면 `.guests` 파일만 수정해도 자동으로 실습 서버로의 접속이 막히는 메커니즘을 구현할 수 있을 것으로 생각한다. [참고](http://www.cyberciti.biz/tips/linux-pam-configuration-that-allows-or-deny-login-via-the-sshd-server.html)

## 도메인 게스트 계정 목록

* `cseclass`
    * 방학 중 특강이나, 가끔 부정기적/1회적으로 실습실에서 열리는 실습슬 커버하기 위해 개설된 계정
    * 1회성 실습에 대해 매번 계정 요청을 받고 있던 행정실 지은상 선생님의 요청으로 만들어졌다.
    * 패스워드는 `cseclass`이다.
* `icpc`
    * ICPC 소모임 (현재 스눕스)이 만들어질때쯤 바쿠스에 요청해서 생성된 계정.
    * 스누씨 계정이 없는 스눕스 회원이 실습실을 사용하거나, ICPC 예선 등의 대회를 치룰때 사용한다.
    * 패스워드는 `worldfinal`
